<!DOCTYPE html>
<html>
<head>
    <title>Debug API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        button { padding: 12px 24px; margin: 10px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a9e; }
        #output { background: #252526; padding: 15px; border-radius: 4px; margin-top: 20px; white-space: pre-wrap; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .info { color: #dcdcaa; }
    </style>
</head>
<body>
    <h1>ğŸ” Debug API Tester</h1>
    
    <button onclick="testDebugAPI()">ğŸš€ Test Debug API</button>
    <button onclick="viewTraceLog()">ğŸ“‹ View Trace Log</button>
    <button onclick="clearOutput()">ğŸ—‘ï¸ Clear</button>
    
    <div id="output"></div>
    
    <script>
        function log(msg, type = 'info') {
            const output = document.getElementById('output');
            const time = new Date().toLocaleTimeString();
            const className = type;
            output.innerHTML += `<span class="${className}">[${time}] ${msg}</span>\n`;
        }
        
        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }
        
        async function testDebugAPI() {
            clearOutput();
            log('ğŸ”µ Testing debug API...', 'info');
            
            const testData = {
                title: 'Debug Test ' + Date.now(),
                cuisine: 'italian',
                ingredients: '1 cup flour\n2 eggs',
                steps: 'Step 1\nStep 2'
            };
            
            log('ğŸ“¤ Sending: ' + JSON.stringify(testData, null, 2), 'info');
            
            try {
                log('ğŸŒ Fetching api/debug_save.php...', 'info');
                
                const response = await fetch('api/debug_save.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(testData)
                });
                
                log(`ğŸ“¡ HTTP Status: ${response.status} ${response.statusText}`, 
                    response.ok ? 'success' : 'error');
                log(`ğŸ“‹ Content-Type: ${response.headers.get('content-type')}`, 'info');
                log(`ğŸ“ Content-Length: ${response.headers.get('content-length') || 'unknown'}`, 'info');
                
                const text = await response.text();
                log(`ğŸ“¥ Response Length: ${text.length} bytes`, 'info');
                
                if (text.length === 0) {
                    log('âŒ EMPTY RESPONSE!', 'error');
                    log('âš ï¸  Check trace log for details', 'error');
                    return;
                }
                
                log(`ğŸ“ Raw Response:\n${text}`, 'info');
                
                try {
                    const data = JSON.parse(text);
                    log('âœ… Valid JSON!', 'success');
                    log('ğŸ“¦ Parsed Data:\n' + JSON.stringify(data, null, 2), 'success');
                } catch (parseError) {
                    log('âŒ JSON Parse Error: ' + parseError.message, 'error');
                }
                
            } catch (error) {
                log('âŒ Fetch Error: ' + error.message, 'error');
                console.error('Full error:', error);
            }
            
            log('\nğŸ“‹ Now check the trace log!', 'info');
        }
        
        function viewTraceLog() {
            window.open('view_trace_log.php', '_blank');
        }
    </script>
</body>
</html>

